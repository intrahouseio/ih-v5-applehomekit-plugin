/**
 * projecttables.js
 */

const util = require('util');

const Datastore = require('nedb');

async function open(filename) {
  const db = new Datastore({ filename });
  return new Promise((resolve, reject) => {
    db.loadDatabase(err => {
      if (!err) {
        resolve(db);
      } else reject(err);
    });
  });
}

async function get(dbstore, filter, opt) {
  opt = opt || {};
  const { fields } = opt;
  const projection = fields || {}; // Передается projection - список полей: {name:1, txt:1}
  return new Promise((resolve, reject) => {
    dbstore.find(filter, projection, (err, data) => {
      console.log('PT after find err=' + util.inspect(err) + ' docs=' + util.inspect(data));
      if (!err) {
        resolve(data);
      } else reject(err);
    });
  });
}

module.exports = {
  open,
  get
};
